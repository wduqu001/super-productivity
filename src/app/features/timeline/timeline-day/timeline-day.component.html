<div class="day-title">
  @if (timelineDay.isToday) {
  <mat-icon>wb_sunny</mat-icon>
  } {{ timelineDay.dayDate|date:'EEE' }}
  <span class="date">{{ timelineDay.dayDate|date:'d.M.' }}</span>
</div>

<div class="wrapper">
  <div class="inner-wrapper">
    <div
      *ngIf="!timelineDay.entries.length"
      class="no-tasks-msg"
    >
      <!--      {{ T.F.TIMELINE.NO_TASKS|translate }}-->
      It is time to stop working and to relax!
    </div>

    @for (row of timelineDay.entries; track row.id) {
    <div
      class="row"
      [class]="getSizeClass(row)"
    >
      <div
        class="col time"
        [class.hasTime]="!row.isHideTime"
      >
        <div *ngIf="!row.isHideTime && row.type !==TimelineViewEntryType.ScheduledTask">
          <div class="time-val">
            {{ row.start <= now ? (T.F.TIMELINE.NOW|translate) :
            (row.start|roundDuration|date:'HH:mm') }}
          </div>
        </div>
        <div
          *ngIf="(row.type ===TimelineViewEntryType.Task || row.type ===TimelineViewEntryType.SplitTask) && row.data.id !== currentTaskId"
          class="up-down"
        >
          <button
            mat-icon-button
            (click)="moveUp(row.data)"
          >
            <mat-icon>arrow_upward</mat-icon>
          </button>
          <button
            mat-icon-button
            (click)="moveDown(row.data)"
          >
            <mat-icon>arrow_downward</mat-icon>
          </button>
        </div>

        <div
          *ngIf="(row.type ===TimelineViewEntryType.ScheduledTask)"
          class="scheduled-extra-btn"
        >
          <div class="time-badge">{{ row.start|shortPlannedAt:'timeOnly' }}</div>
          <button
            mat-mini-fab
            (click)="editTaskReminder(row.data)"
            color="primary"
          >
            <mat-icon>alarm</mat-icon>
          </button>
        </div>

        <div
          *ngIf="(row.type ===TimelineViewEntryType.TaskPlannedForDay)"
          class="scheduled-extra-btn"
        >
          <button
            mat-icon-button
            (click)="editTaskReminder(row.data)"
            color="primary"
          >
            <mat-icon>edit_calendar</mat-icon>
          </button>
        </div>
      </div>
      <div class="col right">
        @switch (row.type) {
        <!-- -->
        @case (TimelineViewEntryType.Task) {
        <planner-task
          [task]="row.data"
          [day]="timelineDay.dayDate"
        ></planner-task>
        } @case (TimelineViewEntryType.ScheduledTask) {
        <planner-task
          [task]="row.data"
          [day]="timelineDay.dayDate"
        ></planner-task>
        } @case (TimelineViewEntryType.TaskPlannedForDay) {
        <planner-task
          class="planned-for-day"
          [task]="row.data"
          [day]="timelineDay.dayDate"
        ></planner-task>
        } @case (TimelineViewEntryType.SplitTask) {
        <planner-task
          class="split-task"
          [task]="row.data"
          [day]="timelineDay.dayDate"
        ></planner-task>
        <!-- --->
        } @case (TimelineViewEntryType.SplitTaskContinuedLast) {
        <timeline-continued-task
          [splitTaskEntry]="row"
          [isLast]="true"
        ></timeline-continued-task>
        } @case (TimelineViewEntryType.SplitTaskContinued) {
        <timeline-continued-task [splitTaskEntry]="row"></timeline-continued-task>
        } @case (TimelineViewEntryType.CalendarEvent) {
        <planner-calendar-event
          [calendarEvent]="row.data"
          [matTooltip]="'Add event as task'"
        ></planner-calendar-event>
        } @case (TimelineViewEntryType.ScheduledRepeatTaskProjection) {
        <planner-repeat-projection
          [title]="T.F.TIMELINE.TASK_PROJECTION_INFO|translate"
          [repeatCfg]="row.data"
        ></planner-repeat-projection>
        } @case (TimelineViewEntryType.WorkdayStart) {
        <div
          [title]="row.start|date:'medium'"
          class="work-start"
        >
          {{ row.start|date:'d.M.' }} {{ T.F.TIMELINE.START|translate }}
        </div>
        } @case (TimelineViewEntryType.WorkdayEnd) {
        <div
          [title]="row.start|date:'medium'"
          class="work-end"
        >
          {{ row.start|date:'d.M.' }} {{ T.F.TIMELINE.END|translate }}
        </div>
        } @case (TimelineViewEntryType.LunchBreak) {
        <div class="lunch-break">{{ T.F.TIMELINE.LUNCH_BREAK|translate }}</div>
        } @case (TimelineViewEntryType.DayCrossing) {
        <div class="day-crossing separator">
          {{ row.start|date:'d.M.' }}
          <span class="day">{{ row.start|date:'(EEE)' }}</span>
        </div>
        }
        <!--- -->
        }
      </div>
    </div>
    }

    <section
      *ngIf="timelineDay.beyondBudgetTasks.length"
      class="beyond-budget"
    >
      <div class="beyond-budget-title">
        <!--        {{ T.F.TIMELINE.BEYOND_BUDGET|translate }}-->
        tasks planned for day, but not enough time
      </div>

      <div class="beyond-budget-tasks">
        @for (task of timelineDay.beyondBudgetTasks; track task.id) {
        <div class="row">
          <div class="col time">
            <div class="scheduled-extra-btn">
              <button
                mat-icon-button
                (click)="editTaskReminder(task)"
                color=""
              >
                <mat-icon>edit_calendar</mat-icon>
              </button>
            </div>
          </div>
          <div class="col right">
            <planner-task
              [task]="task"
              [day]="timelineDay.dayDate"
            ></planner-task>
          </div>
        </div>
        }
      </div>
    </section>
  </div>
</div>
